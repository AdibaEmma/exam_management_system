<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Staff | Uenr Exam Manager</title>
  <!-- Font Awesome icons (free version)-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="css/styles.css" rel="stylesheet">
  <!-- Fonts CSS-->
  <link rel="stylesheet" href="css/heading.css">
  <link rel="stylesheet" href="css/body.css">

  <style>
  #preview {
    width: 90%;
    height: 90%;
    outline: 1px solid greenyellow;
  }

.attendance-modal {
    width: 1200px !important;
}
  </style>
</head>
<body id="page-top">
  <div id="app">
    <nav class="navbar navbar-expand-lg bg-secondary fixed-top" id="mainNav">
      <div class="container"><a class="navbar-brand js-scroll-trigger" href="#page-top">UENR EXAM MANAGER</a>
        <button class="navbar-toggler navbar-toggler-right font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">Menu <i class="fas fa-bars"></i></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#portfolio">Home</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#about">Take Attendance</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <header class="masthead bg-primary text-white text-center">
      <div class="container d-flex align-items-center flex-column">
        <!-- Masthead Avatar Image--><img class="masthead-avatar mb-5" src="assets/img/uenr1.jpg" style="width: 100px;" alt="">
        <!-- Masthead Heading-->
        <h1 class="masthead-heading mb-0">Examination Scheduling And Attendance Based System</h1>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Masthead Subheading-->
        <p class="pre-wrap masthead-subheading font-weight-light mb-0"></p>
      </div>
    </header>
    <section class="page-section portfolio" id="portfolio">
      <div class="container">
        <!-- Portfolio Section Heading-->
        <div class="text-center">
          <h2 class="page-section-heading text-secondary mb-0 d-inline-block">Home</h2>
        </div>
        <!-- Icon Divider-->
        <div class="divider-custom">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Portfolio Grid Items-->
        <div class="row justify-content-center">
          <!-- Portfolio Items-->
          <div class="col-md-6 col-lg-4 mb-5">
            <div class="portfolio-item mx-auto" data-toggle="modal" data-target="#portfolioModal0">
              <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
              </div><img class="img-fluid" src="assets/img/portfolio/cabin.png" alt="Log Cabin"/>
            </div>
          </div>
          <div class="col-md-6 col-lg-4 mb-5">
            <div class="portfolio-item mx-auto" data-toggle="modal" data-target="#portfolioModal1">
              <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
              </div><img class="img-fluid" src="assets/img/portfolio/cake.png" alt="Tasty Cake"/>
            </div>
          </div>
          <div class="col-md-6 col-lg-4 mb-5">
            <div class="portfolio-item mx-auto" data-toggle="modal" data-target="#portfolioModal2">
              <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100">
                <div class="portfolio-item-caption-content text-center text-white"><i class="fas fa-plus fa-3x"></i></div>
              </div><img class="img-fluid" src="assets/img/portfolio/circus.png" alt="Circus Tent"/>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Portfolio Modal-->
    <div class="portfolio-modal modal fade" id="portfolioModal0" tabindex="-1" role="dialog" aria-labelledby="#portfolioModal0Label" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fas fa-times"></i></span></button>
          <div class="modal-body text-center">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <!-- Portfolio Modal - Title-->
                  <h2 class="portfolio-modal-title text-secondary mb-0">Log Cabin</h2>
                  <!-- Icon Divider-->
                  <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                  </div>
                  <!-- Portfolio Modal - Image--><img class="img-fluid rounded mb-5" src="assets/img/portfolio/cabin.png" alt="Log Cabin"/>
                  <!-- Portfolio Modal - Text-->
                  <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit.Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
                  <button class="btn btn-primary" href="#" data-dismiss="modal"><i class="fas fa-times fa-fw"></i>Close Window</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="portfolio-modal modal fade" id="portfolioModal1" tabindex="-1" role="dialog" aria-labelledby="#portfolioModal1Label" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fas fa-times"></i></span></button>
          <div class="modal-body text-center">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <!-- Portfolio Modal - Title-->
                  <h2 class="portfolio-modal-title text-secondary mb-0">Tasty Cake</h2>
                  <!-- Icon Divider-->
                  <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                  </div>
                  <!-- Portfolio Modal - Image--><img class="img-fluid rounded mb-5" src="assets/img/portfolio/cake.png" alt="Tasty Cake"/>
                  <!-- Portfolio Modal - Text-->
                  <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit.Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
                  <button class="btn btn-primary" href="#" data-dismiss="modal"><i class="fas fa-times fa-fw"></i>Close Window</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="portfolio-modal modal fade" id="portfolioModal2" tabindex="-1" role="dialog" aria-labelledby="#portfolioModal2Label" aria-hidden="true">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fas fa-times"></i></span></button>
          <div class="modal-body text-center">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <!-- Portfolio Modal - Title-->
                  <h2 class="portfolio-modal-title text-secondary mb-0">Circus Tent</h2>
                  <!-- Icon Divider-->
                  <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                  </div>
                  <!-- Portfolio Modal - Image--><img class="img-fluid rounded mb-5" src="assets/img/portfolio/circus.png" alt="Circus Tent"/>
                  <!-- Portfolio Modal - Text-->
                  <p class="mb-5">Lorem ipsum dolor sit amet, consectetur adipisicing elit.Mollitia neque assumenda ipsam nihil, molestias magnam, recusandae quos quis inventore quisquam velit asperiores, vitae? Reprehenderit soluta, eos quod consequuntur itaque. Nam.</p>
                  <button class="btn btn-primary" href="#" data-dismiss="modal"><i class="fas fa-times fa-fw"></i>Close Window</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="page-section bg-primary text-white mb-0" id="about">
      <div class="container">
        <!-- About Section Heading-->
        <div class="text-center">
          <h2 class="page-section-heading d-inline-block text-white">Attendance</h2>
        </div>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <div class="text-center m-0">
            <h4>To take attendance select course code</h4>
          <form>
            <div class="form-row">
              <div class="col-lg-6 col-md-12 col-sm-12 col-sm-12 form-group">
                <input type="text" class="form-control" placeholder="Search for course" v-model="search_course">
              </div>
              <div class="col-lg-6 col-md-12 form-group">
                <div v-if="search_all_courses.length !== 0">
                  <select class="form-control" v-model="selected_course">
                    <option value=""  selected disabled>select course</option>
                    <option v-for="(course,key) in search_all_courses" :key="key">{{course.course_code}}</option>
                  </select>
                </div>
                <div v-else>
                  <span class="alert alert-danger">There are no courses at the moment, try again later</span>
                </div>
                <span class="text-center text-danger">
                  {{error}}
                </span>
              </div>
            </div>
          </form>
        </div>

        <div class="text-center m-0">
                <h4>To view attendance select level, program and course code</h4>
            <form>
                <div class="row">
                    <div class="col-sm-12 col-md-4 col-lg-4 form-group">
                         <select class="form-control">
                             <option value="" selected disabled>select level</option>
                             <option>100</option>
                             <option>200</option>
                             <option>300</option>
                             <option>400</option>
                         </select>
                    </div>
                    <div class="col-sm-12 col-md-4 col-lg-4 form-group">
                         <select class="form-control">
                             <option value="" selected disabled>select program</option>
                             <option></option>
                         </select>
                    </div>
                    <div class="col-sm-12 col-md-4 col-lg-4 form-group">
                         <select class="form-control">
                             <option value="" selected disabled>select course code</option>
                             <option>CENG206</option>
                             <option>CENG308</option>
                             <option>CENG412</option>
                         </select>
                    </div>
                </div>
            </form>
        </div>
        <!-- About Section Content-->
        <div class="row">
            <div class="container mb-3 col-sm-12 col-md-10 col-lg-6">
              <div class="card card-register mx-auto mt-5">
                <div class="card-header text-center text-dark">QR Code Scanner</div>
                <div class="card-body">
                    <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-6 mb-3">
                  <a class="btn btn-outline-secondary btn-block" href="#" id="qr_code_modal" @click.prevent="check_course" data-target="" data-toggle="" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">Scan QR Code</a>
                  </div>
                   <div class="col-sm-12 col-md-6 col-lg-6">
                  <a class="btn btn-success btn-block" href="#" id="attendance_modal" data-toggle="modal"
                      data-target="#attendance" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
                      aria-hidden="true">View List</a>
                  </div>
                </div>
              </div>
            </div>


            <!-- Modal for QR Code Scanner -->
            <div class="col-sm-12 col-md-8 col-lg-8">
              <div class="modal fade" id="qr_code" role="dialog">
                <div class="modal-dialog modal-md">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="alert m-2 text-center" :class="[alert_response === 'success'? 'alert-success':'alert-danger']" role="alert" v-show="show_alert">
                      {{alert_message}}
                    </div>
                    <div class="modal-body">
                      <h5 class="modal-title text-dark text-center" id="ModalLabel">QR Code Scanner</h5>
                      <div class="text-center">
                        <video id="preview" class="w-75"></video>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button class="btn btn-primary mr-3" href="#" data-dismiss="modal"><i class="fas fa-times fa-fw"></i>Close Scanner</button>
                    </div>
                  </div>

                </div>
              </div>
            </div>

             <!-- Modal for Attendance taken -->
                 <div class="modal fade attendance-modal" id="attendance" role="dialog">
                     <div class="modal-dialog modal-lg">
                         <div class="modal-content">
                             <div class="modal-header">
                                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                     <span aria-hidden="true">&times;</span>
                                 </button>
                             </div>
                        
                             <div class="modal-body">
                                 <h5 class="modal-title text-dark text-center" id="ModalLabel">Attendance List</h5>
                                     <div class="table-responsive">
                                         <table
                                             class="table table-hover table-responsive-lg table-responsive-md table-responsive-sm table-responsive-xl">
                                             <thead class="thead-dark">
                                                 <tr>
                                                     <th scope="col">Index No#</th>
                                                     <th scope="col">Name</th>
                                                     <th scope="col">Program</th>
                                                     <th scope="col">Level</th>
                                                     <th scope="col">Registered Course</th>
                                                     <th scope="col">Academic Year</th>
                                                     <th scope="col">Semester</th>
                                                     <th scope="col">Signature</th>
                                                     <th scope="col">Attendance Taken</th>
                                                 </tr>
                                             </thead>
                                             <tbody>
                                                 <tr>
                                                     <td>UE20013016</td>
                                                     <td>Emmanuel Adiba</td>
                                                     <td>BSc Computer Engineering</td>
                                                     <td>400</td>
                                                     <td>Robotics</td>
                                                     <td>2020</td>
                                                     <td>Second</td>
                                                     <td>400</td>
                                                     <td></i>
                                                         <p class="btn btn-info"><i class="fas fa-check"></i></p>
                                                     </td>
                                                 </tr>
                                             </tbody>
                                         </table>
                                 </div>
                             </div>
                             <div class="modal-footer">
                                 <button class="btn btn-primary" href="#" data-dismiss="modal"><i
                                     class="fas fa-times fa-fw"></i>Close Attendance</button>
                                     <button type="button" class="btn btn-secondary mx-2">Save as PDF</button>
                                     </div>
                             </div>
                         </div>
                     </div>
             </div>



            <!-- DataTables Example -->
            <!-- <div class="table-responsive">
              <table class="table table-hover table-responsive-lg table-responsive-md table-responsive-sm table-responsive-xl">
                <thead class="thead-dark">
                  <tr>
                    <th scope="col">Index No#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Program</th>
                    <th scope="col">Level</th>
                    <th scope="col">Registered Courses</th>
                    <th scope="col">Academic Year</th>
                    <th scope="col">Semester</th>
                    <th scope="col">Signature</th>
                    <th scope="col">Attendance Taken</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>UE20013016</td>
                    <td>Emmanuel Adiba</td>
                    <td>BSc Computer Engineering</td>
                    <td>400</td>
                    <td>Robotics</td>
                    <td>2020</td>
                    <td>Second</td>
                    <td>400</td>
                    <td></i><p class="btn btn-info"><i class="fas fa-check"></i></p></td>
                  </tr>
                </tbody>
              </table>
            </div> -->

          </div>
        </div>
      </div>
    </section>
    <section class="page-section" id="contact">
      <div class="container">
        <!-- Contact Section Heading-->
        <div class="text-center">
          <h2 class="page-section-heading text-secondary d-inline-block mb-0">CONTACT</h2>
        </div>
        <!-- Icon Divider-->
        <div class="divider-custom">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Contact Section Content-->
        <div class="row justify-content-center">
          <div class="col-lg-4">
            <div class="d-flex flex-column align-items-center">
              <div class="icon-contact mb-3"><i class="fas fa-mobile-alt"></i></div>
              <div class="text-muted">Phone</div>
              <div class="lead font-weight-bold">(555) 555-5555</div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="d-flex flex-column align-items-center">
              <div class="icon-contact mb-3"><i class="far fa-envelope"></i></div>
              <div class="text-muted">Email</div><a class="lead font-weight-bold" href="mailto:name@example.com">name@example.com</a>
            </div>
          </div>
        </div>
      </div>
    </section>
    <footer class="footer text-center">
      <div class="container">
        <div class="row">
          <!-- Footer Location-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="mb-4"></h4>
            <p class="pre-wrap lead mb-0"></p>
          </div>
          <!-- Footer Social Icons-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="mb-4"></h4><a class="btn btn-outline-light btn-social mx-1" href="https://www.facebook.com/StartBootstrap"><i class="fab fa-fw fa-facebook-f"></i></a><a class="btn btn-outline-light btn-social mx-1" href="https://www.twitter.com/sbootstrap"><i class="fab fa-fw fa-twitter"></i></a><a class="btn btn-outline-light btn-social mx-1" href="https://www.linkedin.com/in/startbootstrap"><i class="fab fa-fw fa-linkedin-in"></i></a><a class="btn btn-outline-light btn-social mx-1" href="https://www.dribble.com/startbootstrap"><i class="fab fa-fw fa-dribbble"></i></a>
          </div>
          <!-- Footer About Text-->
          <div class="col-lg-4">
            <h4 class="mb-4"></h4>
            <p class="pre-wrap lead mb-0"></p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Copyright Section-->
    <section class="copyright py-4 text-center text-white">
      <div class="container"><small class="pre-wrap">2020 Exam Manager. All Rights Reserved</small></div>
    </section>
    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
    <div class="scroll-to-top d-lg-none position-fixed"><a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i class="fa fa-chevron-up"></i></a></div>
  </div>
  <!-- Bootstrap core JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <!-- Third party plugin JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
  <!-- Contact form JS-->
  <script src="assets/mail/jqBootstrapValidation.js"></script>
  <script src="assets/mail/contact_me.js"></script>
  <!-- Core theme JS-->
  <script src="js/scripts.js"></script>

  <script type="text/javascript" src="instascan.min.js"></script>
  <script src="../js/vue.js"></script>

  <script type="text/javascript">

  </script>
  <script>
  const vm = new Vue({
    el: "#app",
    data: {
      selected_course: "",
      search_course: "",
      error: "",
      all_courses: [],
      show_alert: false,
      alert_message: "",
      alert_response: ""
    },
    methods: {
      check_course(){
        vm.show_alert = false
        if(!vm.selected_course) vm.error = "Please select a course"
        else vm.error = ""
        console.log(vm.selected_course)
        if(vm.selected_course.length !== 0){
          let self = this
          self.qrCode()
        }
      },
      qrCode(){
        vm.show_alert = false
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        Instascan.Camera.getCameras()
        .then(cameras => {
          scanner.camera = cameras[cameras.length - 1];
          scanner.start();
          $('#qr_code').modal('show')

        })
        .catch(e => console.error(e));
        scanner.addListener('scan', async content => {
          let json_parse = JSON.parse(content)
          json_parse['course_code'] = vm.selected_course
          let json_stringify = JSON.stringify(json_parse)
          if(json_stringify){
            try {
              let class_attendace = await $.ajax({
                url: "/student_attendance/QRcode_atendance",
                method: "POST",
                contentType: "application/json",
                data: json_stringify
              })

              if(class_attendace.res === "created"){
                vm.alert_message = class_attendace.msg
                vm.alert_response = "success"
                vm.show_alert = true
              }
            } catch (e) {
              console.log(e)
              if(e.responseJSON.res === "registration_error"){
                vm.alert_message = e.responseJSON.msg
                vm.alert_response = ""
                vm.show_alert = true
              }
              if(e.responseJSON.res === "registration_error1"){
                vm.alert_message = e.responseJSON.msg
                vm.alert_response = ""
                vm.show_alert = true
              }
              if(e.responseJSON.res === "exist"){
                vm.alert_message = e.responseJSON.msg
                vm.alert_response = ""
                vm.show_alert = true
              }
            }
          }
        });

      }
    },
    computed: {
      search_all_courses() {
        return this.all_courses.filter((course) => {
          return course.course_code.toLowerCase().includes(this.search_course.toLowerCase());
          })
        }
    },
    async created(){
      try {
        let all_courses = await $.ajax({
          url: "/course/all_courses",
          method: "GET"
        })

        if(all_courses) vm.all_courses = all_courses.data
      } catch (e) {
        console.log(e)
      }
    }
  })
  </script>
</body>
</html>
